<% content_for :head do %>
  <!-- Twitter Widgets Script -->
  <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<% end %>

<div class="min-h-screen bg-gray-50">
  <!-- Hero Section -->
  <div class="relative overflow-hidden" style="background: linear-gradient(135deg, <%= @persona.color_primary %> 0%, <%= @persona.color_secondary %> 100%);">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-24">
      <div class="text-center">
        <!-- Avatar -->
        <% if @persona.avatar_url.present? %>
          <div class="mb-8 flex justify-center">
            <div class="w-32 h-32 sm:w-40 sm:h-40 rounded-full border-4 border-white shadow-2xl overflow-hidden bg-white">
              <%= image_tag @persona.avatar_url, alt: @persona.name, class: "w-full h-full object-cover" %>
            </div>
          </div>
        <% else %>
          <div class="mb-8 flex justify-center">
            <div class="w-32 h-32 sm:w-40 sm:h-40 rounded-full border-4 border-white shadow-2xl bg-white flex items-center justify-center">
              <span class="text-5xl sm:text-6xl font-bold" style="color: <%= @persona.color_primary %>;">
                <%= @persona.name.first %>
              </span>
            </div>
          </div>
        <% end %>

        <!-- Name and Description -->
        <h1 class="text-4xl sm:text-5xl font-bold text-white mb-4">
          <%= @persona.name %>
          <% unless @persona.official? %>
            <span class="inline-block ml-3 px-3 py-1 bg-white/20 backdrop-blur-sm text-white text-sm font-semibold rounded-full border border-white/30">
              Custom Persona
            </span>
          <% end %>
        </h1>
        <p class="text-xl sm:text-2xl text-white/90 italic max-w-2xl mx-auto mb-4">
          "<%= @persona.description %>"
        </p>

        <!-- Twitter Handle -->
        <% if @persona.twitter_enabled? && @persona.twitter_handle.present? %>
          <div class="flex justify-center mb-8">
            <%= link_to "https://twitter.com/#{@persona.twitter_handle}", target: "_blank", rel: "noopener noreferrer", class: "inline-flex items-center px-4 py-2 bg-white/10 backdrop-blur-sm hover:bg-white/20 text-white rounded-full font-semibold transition-all duration-300 border border-white/30 hover:border-white/50" do %>
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
              </svg>
              @<%= @persona.twitter_handle %>
            <% end %>
          </div>
        <% end %>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mt-8">
          <% if @persona.editable_by?(current_user) %>
            <!-- Edit Button (for persona owner) -->
            <%= link_to edit_persona_path(@persona), class: "inline-flex items-center px-6 py-3 bg-white text-gray-900 rounded-xl font-semibold shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300" do %>
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
              <span>Edit Persona</span>
            <% end %>
          <% else %>
            <!-- Follow Button -->
            <%= render 'personas/follow_button_show', persona: @persona %>
          <% end %>

          <!-- Share Dropdown -->
          <div class="relative" data-controller="dropdown">
            <button data-action="click->dropdown#toggle" class="inline-flex items-center px-6 py-3 bg-white/20 backdrop-blur-sm text-white border-2 border-white/30 rounded-xl font-semibold hover:bg-white/30 transition-all duration-300">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
              </svg>
              <span>Share This Persona</span>
            </button>

            <!-- Dropdown Menu -->
            <div data-dropdown-target="menu" class="hidden absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-2xl overflow-hidden z-50 border border-gray-200">
              <div class="p-2">
                <a href="https://twitter.com/intent/tweet?text=Check%20out%20<%= CGI.escape(@persona.name) %>%20on%20Worldviews%20-%20<%= CGI.escape(@persona.description) %>&url=<%= CGI.escape(request.original_url) %>" target="_blank" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 rounded-lg transition-colors group">
                  <svg class="w-5 h-5 mr-3 text-blue-400 group-hover:text-blue-500" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                  </svg>
                  <div>
                    <div class="font-semibold text-sm">Share on X</div>
                    <div class="text-xs text-gray-500">Post to your timeline</div>
                  </div>
                </a>

                <a href="https://www.facebook.com/sharer/sharer.php?u=<%= CGI.escape(request.original_url) %>" target="_blank" class="flex items-center px-4 py-3 text-gray-700 hover:bg-blue-50 rounded-lg transition-colors group">
                  <svg class="w-5 h-5 mr-3 text-blue-600 group-hover:text-blue-700" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                  </svg>
                  <div>
                    <div class="font-semibold text-sm">Share on Facebook</div>
                    <div class="text-xs text-gray-500">Post to your feed</div>
                  </div>
                </a>

                <a href="https://www.reddit.com/submit?url=<%= CGI.escape(request.original_url) %>&title=<%= CGI.escape("#{@persona.name} - #{@persona.description}") %>" target="_blank" class="flex items-center px-4 py-3 text-gray-700 hover:bg-orange-50 rounded-lg transition-colors group">
                  <svg class="w-5 h-5 mr-3 text-orange-500 group-hover:text-orange-600" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                  </svg>
                  <div>
                    <div class="font-semibold text-sm">Share on Reddit</div>
                    <div class="text-xs text-gray-500">Post to a subreddit</div>
                  </div>
                </a>

                <button onclick="navigator.clipboard.writeText('<%= request.original_url %>'); this.querySelector('.copy-text').textContent = 'Copied!'; setTimeout(() => this.querySelector('.copy-text').textContent = 'Copy Link', 2000);" class="w-full flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors group">
                  <svg class="w-5 h-5 mr-3 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                  </svg>
                  <div class="text-left">
                    <div class="font-semibold text-sm copy-text">Copy Link</div>
                    <div class="text-xs text-gray-500">Share anywhere</div>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Decorative wave -->
    <div class="absolute bottom-0 left-0 right-0">
      <svg viewBox="0 0 1440 120" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-12">
        <path d="M0 0L60 10C120 20 240 40 360 46.7C480 53 600 47 720 43.3C840 40 960 40 1080 46.7C1200 53 1320 67 1380 73.3L1440 80V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0V0Z" fill="#F9FAFB"/>
      </svg>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- "Where Do My Ideas Come From?" Section -->
    <div class="bg-white rounded-2xl shadow-lg p-8 mb-12 border-2" style="border-color: <%= @persona.color_primary %>;">
      <div class="flex items-center mb-6">
        <div class="w-12 h-12 rounded-full flex items-center justify-center mr-4" style="background-color: <%= @persona.color_primary %>;">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
          </svg>
        </div>
        <h2 class="text-3xl font-bold text-gray-900">
          üí≠ Where Do My Ideas Come From?
        </h2>
      </div>

      <div class="bg-gray-50 rounded-xl p-6 border-l-4" style="border-color: <%= @persona.color_primary %>;">
        <p class="text-gray-700 leading-relaxed whitespace-pre-wrap font-mono text-sm">
<%= @persona.system_prompt %>
        </p>
      </div>

      <div class="mt-6 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
        <p class="text-sm text-yellow-800">
          <strong>ü§ñ Behind the Scenes:</strong> This is the exact prompt given to the AI (GPT-4) to generate interpretations from <%= @persona.name %>'s perspective. Every news story is filtered through this worldview.
        </p>
      </div>
    </div>

    <!-- Stats Section -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-12">
      <div class="bg-white rounded-xl shadow p-6 text-center border-t-4" style="border-color: <%= @persona.color_primary %>;">
        <div class="text-3xl font-bold" style="color: <%= @persona.color_primary %>;">
          <%= @persona.total_interpretations %>
        </div>
        <div class="text-gray-600 text-sm mt-1">Total Takes</div>
      </div>

      <div class="bg-white rounded-xl shadow p-6 text-center border-t-4" style="border-color: <%= @persona.color_primary %>;">
        <div class="text-3xl font-bold" style="color: <%= @persona.color_primary %>;">
          <%= number_to_human(@persona.average_interpretation_length) %>
        </div>
        <div class="text-gray-600 text-sm mt-1">Avg Length</div>
      </div>

      <div class="bg-white rounded-xl shadow p-6 text-center border-t-4" style="border-color: <%= @persona.color_primary %>;">
        <div class="text-3xl font-bold" style="color: <%= @persona.color_primary %>;">
          <%= @persona.most_common_category&.titleize || "N/A" %>
        </div>
        <div class="text-gray-600 text-sm mt-1">Top Category</div>
      </div>
    </div>

    <!-- Twitter Timeline Section -->
    <% if @persona.twitter_enabled? && @persona.twitter_handle.present? %>
      <div class="bg-white rounded-2xl shadow-lg p-8 mb-12">
        <h2 class="text-3xl font-bold text-gray-900 mb-6 flex items-center">
          <svg class="w-8 h-8 mr-3" fill="currentColor" viewBox="0 0 24 24" style="color: <%= @persona.color_primary %>;">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
          </svg>
          Latest Tweets
        </h2>

        <div class="flex flex-col items-center">
          <!-- Twitter Timeline Embed -->
          <div class="w-full max-w-xl">
            <a class="twitter-timeline"
               data-height="600"
               data-theme="light"
               data-chrome="noheader nofooter noborders"
               href="https://twitter.com/<%= @persona.twitter_handle %>?ref_src=twsrc%5Etfw">
              Tweets by @<%= @persona.twitter_handle %>
            </a>
          </div>

          <!-- View on Twitter Button -->
          <div class="mt-6">
            <%= link_to "https://twitter.com/#{@persona.twitter_handle}", target: "_blank", rel: "noopener noreferrer", class: "inline-flex items-center px-6 py-3 rounded-xl font-semibold text-white shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105", style: "background: linear-gradient(135deg, #{@persona.color_primary} 0%, #{@persona.color_secondary} 100%);" do %>
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
              </svg>
              View Full Profile on ùïè
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Recent Interpretations Section -->
    <div class="bg-white rounded-2xl shadow-lg p-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-8 flex items-center">
        <span class="mr-3">üî•</span>
        Recent Hot Takes
      </h2>

      <% if @recent_interpretations.any? %>
        <div class="space-y-6">
          <% @recent_interpretations.each do |interpretation| %>
            <div class="border-l-4 pl-6 py-4 hover:bg-gray-50 transition-colors rounded-r-lg" style="border-color: <%= @persona.color_primary %>;">
              <!-- News Headline -->
              <%= link_to news_story_path(interpretation.news_story), class: "block group" do %>
                <h3 class="text-xl font-semibold text-gray-900 mb-2 group-hover:underline flex items-start">
                  <span class="mr-2">üì∞</span>
                  <%= interpretation.news_story.headline %>
                </h3>
              <% end %>

              <!-- Interpretation Snippet -->
              <p class="text-gray-700 mb-3 line-clamp-3">
                <%= truncate(interpretation.content, length: 200) %>
              </p>

              <!-- Meta Info & Actions -->
              <div class="flex items-center justify-between text-sm">
                <div class="flex items-center space-x-4 text-gray-500">
                  <span><%= interpretation.news_story.source %></span>
                  <span>‚Ä¢</span>
                  <span><%= time_ago_in_words(interpretation.news_story.published_at) %> ago</span>
                </div>
                <div class="flex items-center space-x-4">
                  <%= link_to interpretation_path(interpretation), class: "font-medium hover:underline flex items-center space-x-1", style: "color: #{@persona.color_primary};" do %>
                    <span>üìù Read Full Opinion</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <div class="text-center py-12">
          <p class="text-gray-500 text-lg">No interpretations yet. Check back soon!</p>
        </div>
      <% end %>
    </div>

    <!-- Back to All Personas -->
    <div class="mt-12 text-center">
      <%= link_to personas_path, class: "inline-flex items-center px-6 py-3 border-2 rounded-lg font-medium text-white hover:opacity-90 transition-opacity", style: "background-color: #{@persona.color_primary}; border-color: #{@persona.color_primary};" do %>
        ‚Üê View All Personas
      <% end %>
    </div>
  </div>
</div>
