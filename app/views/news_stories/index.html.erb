<% content_for :title, "News Stories - Worldviews" %>

<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

  <!-- Search Bar -->
  <div class="mb-8" data-controller="search">
    <%= form_with url: news_stories_path, method: :get, class: "relative", data: { turbo_frame: "news_stories", search_target: "form", action: "turbo:submit-end->search#hideLoader" } do |f| %>
      <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
          <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>
        <%= f.text_field :q,
            value: @query,
            placeholder: "Search stories by headline, source, or category...",
            class: "block w-full pl-12 pr-32 py-4 text-lg border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200",
            autocomplete: "off",
            data: { search_target: "input", action: "input->search#search" } %>
        <div class="absolute inset-y-0 right-0 flex items-center pr-2 gap-2">
          <!-- Loader -->
          <div data-search-target="loader" class="hidden">
            <svg class="animate-spin h-5 w-5 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </div>
          <% if @query.present? %>
            <%= link_to news_stories_path, class: "px-4 py-2 text-sm text-gray-600 hover:text-gray-900 font-medium" do %>
              Clear
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

    <% if @query.present? %>
      <div class="mt-3 text-sm text-gray-600">
        <span class="font-semibold"><%= @news_stories.count %></span>
        <%= @news_stories.count == 1 ? 'story' : 'stories' %> found for
        <span class="font-semibold">"<%= @query %>"</span>
      </div>
    <% end %>
  </div>

  <!-- All Stories -->
  <div>
    <h3 class="text-2xl font-bold text-gray-900 mb-6">
      <% if @query.present? %>
        üîç Search Results
      <% else %>
        üì∞ Latest Stories
      <% end %>
    </h3>

    <div data-controller="infinite-scroll">
      <%= render partial: "news_stories_frame", locals: { news_stories: @news_stories, pagy: @pagy, query: @query } %>
    </div>
  </div>
</div>
